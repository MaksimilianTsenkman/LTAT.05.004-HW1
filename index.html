<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Home</title>
</head>
<body>
    <header class="header">
        <ul class="nav">
            <li><a href="index.html" id="home">home</a></li>
            <li><a href="addPost.html">add post</a></li>
        </ul>
        
        <div class="user-profile">
            <a id="logo" class="logo" href="login.html"><img src="res/images/me.jpg" width="60" height="60" alt="My picture" id="user-photo"></a>
            <div class="dropdown" id="dropdown">
                <ul>
                <li><a href="#">John Doe</a></li>
                <li><a href="#">john.doe@ut.ee</a></li>
                <li><a href="#">logout</a></li>
                </ul>
            </div>
        </div>
    </header>
    
    <main>
        <div class="post" hidden>
            <ul class="post-nav">
                <a class="post-logo" href="#"><img src="res/images/me.jpg" width="50" height="50" alt="My picture"></a>
                <p class="date"> October 22, 2022</p>
            </ul>
            <img class="post-img" src="res/images/tartu_2024.jpg" alt="Tartu 2024 sign">
            <p class="title"> Tartu 2022 </p>
            <a href="#"><img id="like" src="res/images/like.png" alt="like icon"></a>
        </div>

        <div id="posts-container"></div>
        <script>

            async function getData() {
                try {
                    const response = await fetch('https://api.npoint.io/ac825739cb1f2120f5e7');
                    if (!response.ok) {
                        throw new Error('Error retrieving data from the server');
                    }
                    const textData = await response.text();
                    const jsonData = JSON.parse(textData);
                    const dataArray = jsonData.posts;
                    console.log(dataArray);
                    return dataArray;
                } catch (error) {
                    console.error('Error:', error);
                    return [];
                }
            }

            function createPost(data) {
                const postTemplate = document.querySelector(".post").cloneNode(true);
                postTemplate.removeAttribute("hidden");
                const postDate = postTemplate.querySelector(".date");
                const postImage = postTemplate.querySelector(".post-img");
                const postText = postTemplate.querySelector(".title");

                if (data.post_image === "") {
                    postTemplate.querySelector(".post-img").remove();
                }

                postText.textContent = data.post_title;
                postDate.textContent = data.date;
                postImage.src = data.post_image;

                document.querySelector("#posts-container").appendChild(postTemplate);
            }

            // (async () => {
            //     const dataArray = await getData();
            //     for (const data of dataArray) {
            //         createPost(data);
            //     }
            // })();

        </script>

        <script type="module">
            import data from "./some_json.json" assert { type: "json" };
            for (const d of data.posts) {
                createPost(d);
            }
        </script>

    </main>

    <footer>
        <div>
            <p class="copyright" >Copyright Â© All Rights Reserved</p>
        </div>
    </footer>
</body>
</html>